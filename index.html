<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Logux Status</title>
    <style>
      body {
        font-family: sans-serif;
        margin: 2em;
      }
      article {
        max-width: 40em;
        margin: 0 auto;
      }
      img {
        float: right;
        margin: 0 0 2em 2em;
      }
      h1 {
        margin: 0 0 1em 0;
      }
      h2 {
        margin: 2em 0 1em 0;
      }
      p {
        margin: 0 0 1em 0;
      }
      section {
        margin-top: 1.5em;
      }
      footer {
        font-size: small;
        margin-top: 0.5em;
      }
    </style>
  </head>
  <body>
    <article>
      <img width="100" height="100"
           src="https://cdn.rawgit.com/logux/logux/master/logo.svg" />
      <h1>Logux Status</h1>
      <p>
        <a href="https://github.com/logux">Logux</a>
        is a client-server communication tool.
        It synchronizes actions between clients and server logs.
      </p>
      <p>
        provides UX best practices to report Logux synchronization status
        <a href="https://github.com/logux/logux-status">Logux Status</a>
        to user.
      </p>
      <p>
        This page tests Logux Status features:
      </p>
      <ul>
        <li>
          <strong>attention</strong> highlights tab on synchronization error
          to notify user.
        </li>
        <li>
          <strong>confirm</strong> shows confirm popup, when user close tab
          with non-synchronized actions.
        </li>
        <li>
          <strong>favicon</strong> changes favicon
          to show synchronization status.
        </li>
        <li>
          <strong>log</strong> displays Logux events in browser console.
        </li>
      </ul>
      <h2>Controls</h2>
      <section>
        <label>
          <input type="checkbox" id="connection" checked />
          Client connected to server
        </label>
        <footer>
          Tests:
          <strong>favicon</strong>,
          <strong>log</strong>
        </footer>
      </section>
      <section>
        <button id="clientError">Error after 3 seconds</button>
        <footer>
          Tests:
          <strong>attention</strong>,
          <strong>favicon</strong>,
          <strong>log</strong>
        </footer>
      </section>
      <section>
        <button id="serverError">Server error after 3 seconds</button>
        <footer>
          Tests:
          <strong>attention</strong>,
          <strong>favicon</strong>,
          <strong>log</strong>
        </footer>
      </section>
      <section>
        <button id="add">Add action to log</button>
        <footer>
          Tests:
          <strong>confirm</strong>,
          <strong>log</strong>
        </footer>
      </section>
      <section>
        <button id="clean">Clean actions</button>
        <footer>
          Tests:
          <strong>log</strong>
        </footer>
      </section>
    </article>
  <script>!function(t){function e(i){if(n[i])return n[i].exports;var o=n[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,e),o.l=!0,o.exports}var n={};e.m=t,e.c=n,e.i=function(t){return t},e.d=function(t,n,i){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:i})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="/",e(e.s=32)}([function(t,e){function n(t,e,n){if("function"!=typeof n)throw new Error("Expected event listener to be a function");var i=!0,o={fn:n};return o.rm=function(){if(i){i=!1;var n=t[e];n.length>1?n.splice(n.indexOf(o),1):delete t[e]}},t[e]?t[e].push(o):t[e]=[o],o}t.exports=function(){this.events={}},t.exports.prototype={on:function(t,e){return n(this.events,t,e).rm},once:function(t,e){var i=n(this.events,t,e);return i.once=!0,i.rm},emit:function(t){var e=this.events[t];if(!e||!e.length)return!1;for(var n=e.slice(0),i=new Array(arguments.length-1),o=1;o<arguments.length;o++)i[o-1]=arguments[o];for(o=0;o<n.length;o++){var r=n[o];r.fn.apply(this,i),r.once&&r.rm()}return!0}}},function(t,e,n){function i(t){if(t||(t={}),void 0===t.nodeId)throw new Error("Expected node ID for Logux");if(this.nodeId=t.nodeId,this.lastTime=0,this.sequence=0,"object"!=typeof t.store)throw new Error("Expected Logux store to be a object");this.store=t.store,this.emitter=new o}var o=n(0);i.prototype={on:function(t,e){return this.emitter.on(t,e)},once:function(t,e){return this.emitter.once(t,e)},add:function(t,e){if(void 0===t.type)throw new Error('Expected "type" property in action');e||(e={});var n=!1;void 0===e.id&&(n=!0,e.id=this.generateId()),void 0===e.time&&(e.time=e.id[0]),void 0===e.reasons&&(e.reasons=[]);var i=this.emitter;return i.emit("before",t,e),0===e.reasons.length&&n?(i.emit("add",t,e),i.emit("clean",t,e),Promise.resolve(e)):0===e.reasons.length?this.store.has(e.id).then(function(n){return!n&&(i.emit("add",t,e),i.emit("clean",t,e),e)}):this.store.add(t,e).then(function(e){return e!==!1&&(i.emit("add",t,e),e)})},generateId:function(){var t=Date.now();return t<=this.lastTime?(t=this.lastTime,this.sequence+=1):(this.lastTime=t,this.sequence=0),[t,this.nodeId,this.sequence]},each:function(t,e){e||(e=t,t={order:"created"});var n=this.store;return new Promise(function(i){function o(t){t().then(function(t){for(var n,r=0;r<t.entries.length;r++){var s=t.entries[r];if((n=e(s[0],s[1]))===!1)break}n!==!1&&t.next?o(t.next):i()})}o(n.get.bind(n,t))})},changeMeta:function(t,e){var n;for(n in e)if("id"===n||"added"===n||"time"===n)throw new Error("Changing "+n+" is prohibbited in Logux");var i=this.emitter;return e.reasons&&0===e.reasons.length?this.store.remove(t).then(function(t){if(t){for(n in e)t[1][n]=e[n];i.emit("clean",t[0],t[1])}return!!t}):this.store.changeMeta(t,e)},removeReason:function(t,e){e||(e={});var n=this;return this.store.removeReason(t,e,function(t,e){n.emitter.emit("clean",t,e)})}},t.exports=i},function(t,e,n){function i(t){return t.map(function(t){return[t[0],t[1]]})}function o(t,e){return t.lastAdded+=1,e[1].added=t.lastAdded,t.added.unshift(e),Promise.resolve(e[1])}function r(t,e){for(var n=e[0],i=e.slice(1).join("\t"),o=0,r=t.length-1;o<=r;){var s=r+o>>1,c=t[s],A=c[1].id[0];if(A>n)o=s+1;else if(A<n)r=s-1;else if(c[2]>i)o=s+1;else{if(!(c[2]<i))return s;r=s-1}}return-1}function s(){this.created=[],this.added=[],this.lastReceived=0,this.lastAdded=0,this.lastSent=0}var c=n(19);s.prototype={add:function(t,e){for(var n=e.id.slice(1).join("\t"),i=[t,e,n],r=this.created,s=0;s<r.length;s++){var A=r[s];if(e.id[0]===A[1].id[0]&&n===A[2])return Promise.resolve(!1);if(c(A[1],e)>0)return r.splice(s,0,i),o(this,i)}return r.push(i),o(this,i)},has:function(t){return Promise.resolve(r(this.created,t)!==-1)},remove:function(t){var e=r(this.created,t);if(e===-1)return Promise.resolve(!1);var n=[this.created[e][0],this.created[e][1]];this.created.splice(e,1);for(var i=n[1].added,o=0,s=this.added.length-1;o<=s;){var c=s+o>>1,A=this.added[c][1].added;if(A>i)o=c+1;else{if(!(A<i)){this.added.splice(c,1);break}s=c-1}}return Promise.resolve(n)},get:function(t){var e;return e="created"===t.order?this.created:this.added,Promise.resolve({entries:i(e)})},changeMeta:function(t,e){var n=r(this.created,t);if(n===-1)return Promise.resolve(!1);var i=this.created[n][1];for(var o in e)i[o]=e[o];return Promise.resolve(!0)},removeReason:function(t,e,n){var i=[];return this.created=this.created.filter(function(o){var r=o[1],s=e;if(r.reasons.indexOf(t)===-1)return!0;if(void 0!==s.minAdded&&r.added<s.minAdded)return!0;if(void 0!==s.maxAdded&&r.added>s.maxAdded)return!0;var c=r.reasons;return c.splice(c.indexOf(t),1),0!==r.reasons.length||(n(o[0],r),i.push(r.added),!1)}),this.added=this.added.filter(function(t){return i.indexOf(t[1].added)===-1}),Promise.resolve()},getLastAdded:function(){return Promise.resolve(this.lastAdded)},getLastSynced:function(){return Promise.resolve({received:this.lastReceived,sent:this.lastSent})},setLastSynced:function(t){return void 0!==t.sent&&(this.lastSent=t.sent),void 0!==t.received&&(this.lastReceived=t.received),Promise.resolve()}},t.exports=s},function(t,e,n){function i(t,e,n){t.options.outMap?t.options.outMap(e,n).then(function(e){t.sendSync(e[0],e[1])}):t.sendSync(e,n)}function o(t,e,n,i){if(this.localNodeId=t,this.log=e,this.connection=n,this.options=i||{},this.options.ping&&!this.options.timeout)throw new Error("You must set timeout option to use ping");this.connected=!1,this.authenticated=!1,this.authenticating=!1,this.unauthenticated=[],this.timeFix=0,this.syncing=0,this.received={},this.lastSent=0,this.lastReceived=0,this.state="disconnected",this.emitter=new r,this.timeouts=[],this.throwsError=!0,this.unbind=[];var o=this;this.unbind.push(e.on("add",function(t,e){o.onAdd(t,e)})),this.unbind.push(n.on("connecting",function(){o.onConnecting()})),this.unbind.push(n.on("connect",function(){o.onConnect()})),this.unbind.push(n.on("message",function(t){o.onMessage(t)})),this.unbind.push(n.on("error",function(t){"Wrong message format"===t.message?o.sendError(new u(o,"wrong-format",t.received)):o.error(t),o.connection.disconnect("error")})),this.unbind.push(n.on("disconnect",function(){o.onDisconnect()})),this.lastAddedCache=0,this.initializing=this.initialize()}var r=n(0),s=n(21),c=n(23),A=n(24),a=n(25),d=n(22),u=n(6),h=[c,s,A,a,d],g=["connect","connected","error"];o.prototype={remoteNodeId:void 0,localProtocol:[0,1],remoteProtocol:void 0,remoteSubprotocol:void 0,on:function(t,e){return this.emitter.on(t,e)},once:function(t,e){return this.emitter.once(t,e)},catch:function(t){this.throwsError=!1,this.on("error",t)},waitFor:function(t){var e=this;return new Promise(function(n){var i=e.on("state",function(){e.state===t&&(i(),n())})})},destroy:function(){this.connection.destroy?this.connection.destroy():this.connected&&this.connection.disconnect("destroy");for(var t=0;t<this.unbind.length;t++)this.unbind[t]()},send:function(t){if(!this.connected){var e=JSON.stringify(t);throw new Error("Could not send "+e+" to disconnected connection")}this.delayPing(),this.connection.send(t)},onConnecting:function(){this.setState("connecting")},onConnect:function(){this.delayPing(),this.connected=!0},onDisconnect:function(){this.endTimeout(),this.pingTimeout&&clearTimeout(this.pingTimeout),this.connected=!1,this.lastAddedCache>this.lastSent?this.setState("wait"):this.setState("disconnected")},onMessage:function(t){this.delayPing();var e=t[0];if(!this.authenticated&&g.indexOf(e)===-1)return void(this.authenticating?this.unauthenticated.push(t):this.sendError(new u(this,"missed-auth",JSON.stringify(t))));for(var n=new Array(t.length-1),i=1;i<t.length;i++)n[i-1]=t[i];this[e+"Message"].apply(this,n)},onAdd:function(t,e){if(!this.connected)return void this.setState("wait");if(this.lastAddedCache<e.added&&(this.lastAddedCache=e.added),this.received[e.id.join("\t")])return void delete this.received[e.id.join("\t")];if(this.options.outFilter){var n=this;this.options.outFilter(t,e).then(function(o){o&&i(n,t,e)})}else i(this,t,e)},syncError:function(t,e,n){var i=new u(this,t,e,n);this.error(i)},error:function(t){if(this.emitter.emit("error",t),this.throwsError)throw t},setState:function(t){this.state!==t&&(this.state=t,this.emitter.emit("state"))},startTimeout:function(){if(this.options.timeout){var t=this.options.timeout,e=this,n=setTimeout(function(){e.connected&&e.connection.disconnect("timeout"),e.syncError("timeout",t)},t);this.timeouts.push(n)}},endTimeout:function(){this.timeouts.length>0&&clearTimeout(this.timeouts.shift())},delayPing:function(){if(this.options.ping){this.pingTimeout&&clearTimeout(this.pingTimeout);var t=this;this.pingTimeout=setTimeout(function(){t.connected&&t.sendPing()},this.options.ping)}},syncSince:function(t){var e=[],n=this;this.log.each({order:"added"},function(n,i){return!(i.added<=t)&&(e.push(n,i),!0)}).then(function(){n.connected&&(e.length>0?n.sendSync.apply(n,e):n.setState("synchronized"))})},setLastSent:function(t){this.lastSent<t&&(this.lastSent=t),this.log.store.setLastSynced({sent:t})},setLastReceived:function(t){this.lastReceived<t&&(this.lastReceived=t),this.log.store.setLastSynced({received:t})},now:function(){return Date.now()},initialize:function(){var t=this;return Promise.all([this.log.store.getLastSynced(),this.log.store.getLastAdded()]).then(function(e){t.lastSent=e[0].sent,t.lastReceived=e[0].received,t.lastAddedCache=e[1],t.lastAddedCache>t.lastSent&&t.setState("wait"),t.connection.connected&&t.onConnect()})},sendDuilian:function(t){var e=Object.keys(p);void 0===t&&(t=Math.floor(Math.random()*e.length)),this.send(["duilian",e[t]])},duilianMessage:function(t){p[t]&&this.send(["duilian",p[t]])}};for(var l=0;l<=h.length;l++){var f=h[l];for(var m in f)o.prototype[m]=f[m]}var p={"世事洞眀皆學問":"人情練達即文章","書山有路勤爲徑":"學海無涯苦作舟"};t.exports=o},function(t,e,n){function i(t,e,n,i){i=r(i,s),o.call(this,t,e,n,i)}var o=n(3),r=n(5),s={fixTime:!0,timeout:2e4,ping:5e3};i.prototype={onConnect:function(){if(!this.connected){this.connected=!0;var t=this;this.initializing=this.initializing.then(function(){t.connected&&t.sendConnect()})}}},i.prototype=r(i.prototype,o.prototype),t.exports=i},function(t,e){t.exports=function(t,e){t||(t={});for(var n in e)void 0===t[n]&&(t[n]=e[n]);return t}},function(t,e){function n(t){return t.map(function(t){return t+".x"}).join(", ")}function i(t,e,n,o){Error.call(this,e),this.name="SyncError",this.type=e,this.options=n,this.description=i.describe(e,n),this.sync=t,this.received=!!o,this.message="",o?(this.sync.remoteNodeId?this.message+=this.sync.remoteNodeId+" sent ":this.message+="Logux received ",this.message+=this.type+" error",this.description!==this.type&&(this.message+=" ("+this.description+")")):this.message=this.description,Error.captureStackTrace&&Error.captureStackTrace(this,i)}i.describe=function(t,e){return"timeout"===t?"A timeout was reached ("+e+"ms)":"wrong-format"===t?"Wrong message format in "+e:"unknown-message"===t?"Unknown message `"+e+"` type":"missed-auth"===t?"Start authentication before sending message "+e:"wrong-protocol"===t?"Only "+n(e.supported)+" Logux protocols are supported, but you use "+e.used.join("."):"wrong-subprotocol"===t?"Only "+e.supported+" application subprotocols are supported, but you use "+e.used:"wrong-credentials"===t?"Wrong credentials":t},i.prototype=Error.prototype,t.exports=i},function(t,e){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e){function n(t){function e(){s&&(r.title=s,s=!1)}function n(){r.hidden&&!s?(s=r.title,r.title+="*"):e(),r.hidden&&(A=setTimeout(n,1e3))}function i(){!r.hidden&&A&&(A=clearTimeout(A),e())}var o=t.sync,r=document,s=!1,c=[],A=!1;return void 0!==r&&void 0!==r.hidden&&(c.push(o.on("error",function(t){"timeout"===t.type||A||n()})),document.addEventListener("visibilitychange",i,!1),c.push(function(){document.removeEventListener("visibilitychange",i,!1)})),function(){for(var t=0;t<c.length;t++)c[t]()}}t.exports=n},function(t,e){function n(t,e){function n(t){return void 0===t&&(t=window.event),t&&(t.returnValue=e),e}var i=t.sync;return e=e||"Some data was not saved to server. Are you sure to leave?",i.on("state",function(){"wait"===i.state||"sending"===i.state?window.addEventListener("beforeunload",n):window.removeEventListener("beforeunload",n)})}t.exports=n},function(t,e){function n(t,e){e=e||{};var n=t.sync,i=e.normal,o=e.offline,r=e.error,s=[],c=document,A=!1,a=!1;return void 0!==c&&(A=c.querySelector('link[rel~="icon"]'),A||(A=document.createElement("link"),A.rel="icon",A.href="",document.head.appendChild(A)),s.push(n.on("state",function(){n.connected&&i&&a!==i?A.href=a=i:!n.connected&&o&&a!==o&&a!==r&&(A.href=a=o)})),s.push(n.on("error",function(t){"timeout"!==t.type&&r&&a!==r&&(A.href=a=r)}))),function(){for(var t=0;t<s.length;t++)s[t]()}}t.exports=n},function(t,e,n){function i(t){return"%c"+t+"%c"}function o(t,e,n,i){e="%cLogux:%c "+e,t||(e=e.replace(/%c/g,""));var o,r=[e];if(t){var s=e.match(/%c[^%]+%c/g);for(o=0;o<s.length;o++)0===o?r.push("color: #ffa200"):r.push("font-weight: bold"),r.push("")}return n&&i&&(r.push(n),r.push(i)),r}function r(t,e){function n(t,e,n){console.log.apply(console,o(A,t,e,n))}function r(t){var e="error: "+t.description;t.received&&(e="server sent "+e),console.error.apply(console,o(A,e))}e||(e={});var c=t.sync,A=e.color!==!1&&s(),a=[],d=!1;return e.state!==!1&&a.push(c.on("state",function(){var t="";"connecting"===c.state&&c.connection.url&&(t=". "+i(c.localNodeId)+" is connecting to "+i(c.connection.url)+"."),c.connected&&!d?(t=". Client was connected to "+i(c.remoteNodeId)+".",d=!0):c.connected||(d=!1),n("state was changed to "+i(c.state)+t)})),e.error!==!1&&(a.push(c.on("error",function(t){r(t)})),a.push(c.on("clientError",function(t){r(t)}))),e.add!==!1&&a.push(c.log.on("add",function(t,e){var o="action "+i(t.type)+" was added";e.id[1]!==c.localNodeId&&(o+=" by "+i(e.id[1])),n(o,t,e)})),e.clean!==!1&&a.push(c.log.on("clean",function(t,e){n("action "+i(t.type)+" was cleaned",t,e)})),function(){for(var t=0;t<a.length;t++)a[t]()}}var s=n(17);t.exports=r},function(t,e,n){(function(e){function i(t,e){return t.options.prefix+":"+t.options.userId+":"+e}function o(t,e,n){"undefined"!=typeof localStorage&&localStorage.setItem(i(t,e),JSON.stringify(n))}function r(t){var e,n=localStorage.getItem(i(t,"leader"));return"string"==typeof n&&(e=JSON.parse(n)),"object"==typeof e&&null!==e&&2===e.length?e:[]}function s(t){o(t,"leader",[t.id,Date.now()])}function c(t){clearTimeout(t.watching),t.watching=setTimeout(function(){t.start()},t.timeout)}function A(t,e){if(t.role!==e){var n=t.sync;if(t.role=e,clearTimeout(t.watching),"leader"===e?("undefined"!=typeof localStorage&&localStorage.removeItem(i(t,"state")),t.leadership=setInterval(function(){s(t)},2e3),n.connection.connect()):(clearTimeout(t.elections),clearInterval(t.leadership),"disconnected"!==n.state&&"wait"!==n.state&&t.sync.connection.disconnect()),"follower"===e){var o="disconnected",r=localStorage.getItem(i(t,"state"));r&&null!==r&&(o=JSON.parse(r)),o!==t.state&&(t.state=o,t.emitter.emit("state"))}t.emitter.emit("role")}}function a(t){if(this.options=t||{},void 0===this.options.url)throw new Error("Missed url option in Logux client");if(void 0===this.options.subprotocol)throw new Error("Missed subprotocol option in Logux client");if(void 0===this.options.userId)throw new Error("Missed userId option in Logux client. Pass false if you have no users.");void 0===this.options.prefix&&(this.options.prefix="logux"),this.role="candidate",this.timeout=3e3+Math.floor(1e3*Math.random()),this.id=f(0);var n=this.options.userId;n?n+=":":n="",this.options.nodeId=n+this.id;var r;/^ws:\/\//.test(this.options.url)&&!t.allowDangerousProtocol&&(r=function(t){return"object"!=typeof t||"development"!==t.env?(console.error("Without SSL, old proxies can block WebSockets. Use WSS connection for Logux or set allowDangerousProtocol option."),Promise.resolve(!1)):Promise.resolve(!0)});var s=this.options.store;s||(s=e.indexedDB?new p(this.options.prefix+":"+this.options.userId):new u),this.log=new m({store:s,nodeId:this.options.nodeId});var a=new d(this.options.url),v=new l(a,{minDelay:this.options.minDelay,maxDelay:this.options.maxDelay,attempts:this.options.attempts});this.sync=new h(this.options.nodeId,this.log,v,{credentials:this.options.credentials,subprotocol:this.options.subprotocol,timeout:this.options.timeout,ping:this.options.ping,auth:r}),this.state=this.sync.state,this.emitter=new g;var D=this;this.sync.on("state",function(){"leader"===D.role&&(D.state=D.sync.state,D.emitter.emit("state"),o(D,"state",D.state))}),this.sync.on("debug",function(t,e){"error"===t&&console.error("Error on Logux server:\n",e)}),this.log.on("add",function(t,e){D.emitter.emit("add",t,e),e.tab!==D.id&&o(D,"add",[t,e])}),this.log.on("clean",function(t,e){D.emitter.emit("clean",t,e),e.tab!==D.id&&o(D,"clean",[t,e])}),this.storageListener=function(t){if(null!==t.newValue){var e;if(t.key===i(D,"add"))e=JSON.parse(t.newValue),e[1].tab&&e[1].tab!==D.id||D.emitter.emit("add",e[0],e[1]);else if(t.key===i(D,"clean"))e=JSON.parse(t.newValue),e[1].tab&&e[1].tab!==D.id||D.emitter.emit("clean",e[0],e[1]);else if(t.key===i(D,"leader"))A(D,"follower"),c(D);else if(t.key===i(D,"state")){var n=JSON.parse(localStorage.getItem(t.key));D.state!==n&&(D.state=n,D.emitter.emit("state"))}}},window.addEventListener("storage",this.storageListener)}var d=n(20),u=n(2),h=n(4),g=n(0),l=n(26),f=n(28),m=n(1),p=n(18);a.prototype={start:function(){if("undefined"==typeof localStorage)return this.role="leader",this.emitter.emit("role"),void this.sync.connection.connect();var t=!1,e=r(this);if(e[1]&&e[1]>=Date.now()-5e3&&(t=!0),t)A(this,"follower"),c(this);else{var n=this;s(n),A(n,"candidate"),n.elections=setTimeout(function(){r(n,"leader")[0]===n.id?A(n,"leader"):(A(n,"follower"),c(n))},1e3)}},destroy:function(){this.sync.destroy(),clearTimeout(this.watching),clearTimeout(this.elections),clearInterval(this.leadership),window.removeEventListener("storage",this.storageListener)},clean:function(){return this.destroy(),"undefined"!=typeof localStorage&&(localStorage.removeItem(i(this,"add")),localStorage.removeItem(i(this,"clean")),localStorage.removeItem(i(this,"state")),localStorage.removeItem(i(this,"leader"))),this.log.store.clean?this.log.store.clean():(this.log=void 0,Promise.resolve())},on:function(t,e){return this.emitter.on(t,e)},once:function(t,e){return this.emitter.once(t,e)}},t.exports=a}).call(e,n(7))},function(t,e,n){function i(t,e){this.connected=!1,this.emitter=new r,this.type=e,this.pair=t}function o(){this.left=new i(this,"left"),this.right=new i(this,"right")}var r=n(0);i.prototype={other:function(){return"left"===this.type?this.pair.right:this.pair.left},on:function(t,e){return this.emitter.on(t,e)},connect:function(){if(this.connected)throw new Error("Connection already established");var t=this;return new Promise(function(e){setTimeout(function(){t.other().connected=!0,t.connected=!0,t.other().emitter.emit("connect"),t.emitter.emit("connect"),e()},1)})},disconnect:function(t){if(this.connected){this.connected=!1,this.emitter.emit("disconnect",t);var e=this;return new Promise(function(t){setTimeout(function(){e.other().connected=!1,e.other().emitter.emit("disconnect"),t()},1)})}throw new Error("Connection already finished")},send:function(t){if(!this.connected)throw new Error("Connection should be started before sending a message");var e=this;setTimeout(function(){e.other().emitter.emit("message",t)},1)}},o.prototype={},t.exports=o},function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHgAAAB4CAMAAAAOusbgAAABzlBMVEUAAAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AADGIKqbAAAAmXRSTlMAAQQFBgcLDA0ODxESExQVFhcYGRobHB0eHyAhIiMkJSYnKCksLS4wMTI3ODo7PD0+P0xNT1BTVFVXWFpbXl9gYWJmaWprbW6AgYKDhYaHiImKi4yNjo+RkpSXmZqbnJ2foqqtrq+5u7y+xMXGx8jJysvQ0dLT1dbY2drc3d7g4eLj5OXm5+jq6+zt7u/w8fX29/j5+vv8/f5OSOWKAAACyklEQVR4Ae3aA7okSxQE4Bjbtm3bc23btm2b1f1ex25nA1nO813Vv4BCGoGdIBAIBI49/ZVS1dQ5uGAYC4OdTZUpv54eg7TTHwuGqDBZ/vsSxNxJ7qeFvsTbEHA8po22WqKPQ6+LOSt0ZL3gAvS5krNGx0Jlt6DH/pQwXQnnHIIGb8bo2uS3XfDpSh09qb0EX94u0KOlj/BuT0qEnkVy9sKjM230pfkUPLnST5+GbsCDexP0bfohXHu1TA2WX8Cl+4vUYvkRXLk2RU1mbsKFk/3UZvA0HNvXRo2a98KpXGqVCYdeR6hV5B0cuThPzRauwIFdddSuBg58pYBPsHVoggKmDsu3aLUs2LjxH0WEr8FaCYUUwtIFg0JCl2Alj2JyYOHEKsWsHoO5GAqKgrk2CmqGqTsUdQtmkikqHmb6KaoHJs5R2DmofaOwr1ArpbBiqI1Q2BCUjlPcUag8o7gnUPlFcd+hkkpxSVCporgKqDRRXD1UuiiuAyrDFDcElXmKm4WKQXHrG//ijS/qjWxcG9adNmwA2bAhM4XiEqHyk+K+QeUpxT2GylGKO4qN6chDG7W8LdqoBf0XqJ2lrMgZmOilqG6YSaKoOJi5uVEbc7RSUCPMRVPQH5g7vkoxK8dgIZdismHlvEEh6+dgqYhC8mHtWpgiQldgI5si0mHn4DgFTB6Crc8U8AEO1FK7ajhxYY6aLVzeoCu+t1CRb9lpcGpvMzVq2APHTvRSm4FTcOHqJDWZvAJX7ukKJzyESy+XqMHSc7h2d5y+TT2AB1f66NPgdXhyqpm+NJyAR7tj/5ePVam9madHS+/hy6UaelJ9AX69GaVrE9+gwaGsMF0JZRyAHpfdBEKNshvQ51SK4wjseeh1LKqZtpr+HoWAmwk9tNAddwNiTn4sGDQJdl+AtKNPfiRXNLQPzhvG/GB7fUXS9ydHsAMEAoHAP3w+T5jYJRnoAAAAAElFTkSuQmCC"},function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHgAAAB4CAMAAAAOusbgAAABzlBMVEUAAAAAAAAAgAAAmQAAgAAAkgAAiwAAgAAAiQAAgAAAiAAAhwAAgAAAhgAAgAAAhgAAgAAAhQAAgAAAhQAAgAAAhAAAgAAAhAAAgAAAhAAAgAAAgwAAgAAAgwAAgAAAgwAAgAAAgwAAgAAAgwAAgAAAggAAgAAAgAAAggAAgAAAggAAgAAAgAAAggAAgAAAggAAgAAAggAAgAAAgQAAgQAAgAAAgQAAgAAAgQAAgQAAgAAAgAAAgQAAgAAAgQAAgAAAgQAAgAAAgAAAgQAAgAAAgQAAgQAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgACYS+jrAAAAmXRSTlMAAQQFBgcLDA0ODxESExQVFhcYGRobHB0eHyAhIiMkJSYnKCksLS4wMTI3ODo7PD0+P0xNT1BTVFVXWFpbXl9gYWJmaWprbW6AgYKDhYaHiImKi4yNjo+RkpSXmZqbnJ2foqqtrq+5u7y+xMXGx8jJysvQ0dLT1dbY2drc3d7g4eLj5OXm5+jq6+zt7u/w8fX29/j5+vv8/f5OSOWKAAACyklEQVR4Ae3aA7okSxQE4Bjbtm3bc23btm2b1f1ex25nA1nO813Vv4BCGoGdIBAIBI49/ZVS1dQ5uGAYC4OdTZUpv54eg7TTHwuGqDBZ/vsSxNxJ7qeFvsTbEHA8po22WqKPQ6+LOSt0ZL3gAvS5krNGx0Jlt6DH/pQwXQnnHIIGb8bo2uS3XfDpSh09qb0EX94u0KOlj/BuT0qEnkVy9sKjM230pfkUPLnST5+GbsCDexP0bfohXHu1TA2WX8Cl+4vUYvkRXLk2RU1mbsKFk/3UZvA0HNvXRo2a98KpXGqVCYdeR6hV5B0cuThPzRauwIFdddSuBg58pYBPsHVoggKmDsu3aLUs2LjxH0WEr8FaCYUUwtIFg0JCl2Alj2JyYOHEKsWsHoO5GAqKgrk2CmqGqTsUdQtmkikqHmb6KaoHJs5R2DmofaOwr1ArpbBiqI1Q2BCUjlPcUag8o7gnUPlFcd+hkkpxSVCporgKqDRRXD1UuiiuAyrDFDcElXmKm4WKQXHrG//ijS/qjWxcG9adNmwA2bAhM4XiEqHyk+K+QeUpxT2GylGKO4qN6chDG7W8LdqoBf0XqJ2lrMgZmOilqG6YSaKoOJi5uVEbc7RSUCPMRVPQH5g7vkoxK8dgIZdismHlvEEh6+dgqYhC8mHtWpgiQldgI5si0mHn4DgFTB6Crc8U8AEO1FK7ajhxYY6aLVzeoCu+t1CRb9lpcGpvMzVq2APHTvRSm4FTcOHqJDWZvAJX7ukKJzyESy+XqMHSc7h2d5y+TT2AB1f66NPgdXhyqpm+NJyAR7tj/5ePVam9madHS+/hy6UaelJ9AX69GaVrE9+gwaGsMF0JZRyAHpfdBEKNshvQ51SK4wjseeh1LKqZtpr+HoWAmwk9tNAddwNiTn4sGDQJdl+AtKNPfiRXNLQPzhvG/GB7fUXS9ydHsAMEAoHAP3w+T5jYJRnoAAAAAElFTkSuQmCC"},function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHgAAAB4CAMAAAAOusbgAAABzlBMVEUAAAAAAACAgICZmZmAgICSkpKLi4uAgICJiYmAgICIiIiHh4eAgICGhoaAgICGhoaAgICFhYWAgICFhYWAgICEhISAgICEhISAgICEhISAgICDg4OAgICDg4OAgICDg4OAgICDg4OAgICDg4OAgICCgoKAgICAgICCgoKAgICCgoKAgICAgICCgoKAgICCgoKAgICCgoKAgICBgYGBgYGAgICBgYGAgICBgYGBgYGAgICAgICBgYGAgICBgYGAgICBgYGAgICAgICBgYGAgICBgYGBgYGAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICq+RHaAAAAmXRSTlMAAQQFBgcLDA0ODxESExQVFhcYGRobHB0eHyAhIiMkJSYnKCksLS4wMTI3ODo7PD0+P0xNT1BTVFVXWFpbXl9gYWJmaWprbW6AgYKDhYaHiImKi4yNjo+RkpSXmZqbnJ2foqqtrq+5u7y+xMXGx8jJysvQ0dLT1dbY2drc3d7g4eLj5OXm5+jq6+zt7u/w8fX29/j5+vv8/f5OSOWKAAACyklEQVR4Ae3aA7okSxQE4Bjbtm3bc23btm2b1f1ex25nA1nO813Vv4BCGoGdIBAIBI49/ZVS1dQ5uGAYC4OdTZUpv54eg7TTHwuGqDBZ/vsSxNxJ7qeFvsTbEHA8po22WqKPQ6+LOSt0ZL3gAvS5krNGx0Jlt6DH/pQwXQnnHIIGb8bo2uS3XfDpSh09qb0EX94u0KOlj/BuT0qEnkVy9sKjM230pfkUPLnST5+GbsCDexP0bfohXHu1TA2WX8Cl+4vUYvkRXLk2RU1mbsKFk/3UZvA0HNvXRo2a98KpXGqVCYdeR6hV5B0cuThPzRauwIFdddSuBg58pYBPsHVoggKmDsu3aLUs2LjxH0WEr8FaCYUUwtIFg0JCl2Alj2JyYOHEKsWsHoO5GAqKgrk2CmqGqTsUdQtmkikqHmb6KaoHJs5R2DmofaOwr1ArpbBiqI1Q2BCUjlPcUag8o7gnUPlFcd+hkkpxSVCporgKqDRRXD1UuiiuAyrDFDcElXmKm4WKQXHrG//ijS/qjWxcG9adNmwA2bAhM4XiEqHyk+K+QeUpxT2GylGKO4qN6chDG7W8LdqoBf0XqJ2lrMgZmOilqG6YSaKoOJi5uVEbc7RSUCPMRVPQH5g7vkoxK8dgIZdismHlvEEh6+dgqYhC8mHtWpgiQldgI5si0mHn4DgFTB6Crc8U8AEO1FK7ajhxYY6aLVzeoCu+t1CRb9lpcGpvMzVq2APHTvRSm4FTcOHqJDWZvAJX7ukKJzyESy+XqMHSc7h2d5y+TT2AB1f66NPgdXhyqpm+NJyAR7tj/5ePVam9madHS+/hy6UaelJ9AX69GaVrE9+gwaGsMF0JZRyAHpfdBEKNshvQ51SK4wjseeh1LKqZtpr+HoWAmwk9tNAddwNiTn4sGDQJdl+AtKNPfiRXNLQPzhvG/GB7fUXS9ydHsAMEAoHAP3w+T5jYJRnoAAAAAElFTkSuQmCC"},function(t,e){function n(){if("undefined"==typeof window||"undefined"==typeof document)return!1;var t="WebkitAppearance"in document.documentElement.style,e=window.console&&(window.console.firebug||window.console.exception&&window.console.table)&&!0,n=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31;return t||e||n||!1}t.exports=n},function(t,e,n){(function(e){function n(t,e){t.onerror=function(t){e(t.target.error)}}function i(t){return new Promise(function(e,i){n(t,i),t.onsuccess=function(t){e(t.target.result)}})}function o(t){return function(e){return e?(e.value.meta.added=e.value.added,{entries:[[e.value.action,e.value.meta]],next:function(){return e.continue(),i(t).then(o(t))}}):{entries:[]}}}function r(t){this.name=t||"logux"}r.prototype={init:function(){if(this.initing)return this.initing;var t=this,n=indexedDB.open(this.name,1);return n.onupgradeneeded=function(t){var e=t.target.result,n=e.createObjectStore("log",{keyPath:"added",autoIncrement:!0});n.createIndex("id","id",{unique:!0}),n.createIndex("created","created",{unique:!0}),n.createIndex("reasons","reasons",{multiEntry:!0}),e.createObjectStore("extra",{keyPath:"key"}).transaction.oncomplete=function(){e.transaction("extra","readwrite").objectStore("extra").add({key:"lastSynced",sent:0,received:0})}},this.initing=i(n).then(function(n){return t.db=n,n.onversionchange=function(){t.db.close(),e.document&&e.document.reload&&e.document.reload()},t}),this.initing},get:function(t){var e;return this.init().then(function(n){var r=n.os("log");return e="created"===t.order?r.index("created").openCursor(null,"prev"):r.openCursor(null,"prev"),i(e).then(o(e))})},has:function(t){return this.init().then(function(e){return i(e.os("log").index("id").get(t))}).then(function(t){return!!t})},remove:function(t){return this.init().then(function(e){var n=e.os("log","write");return i(n.index("id").get(t)).then(function(t){return!!t&&i(n.delete(t.added)).then(function(){return t.meta.added=t.added,[t.action,t.meta]})})})},add:function(t,e){var n={id:e.id,meta:e,time:e.time,action:t,reasons:e.reasons,created:e.time+"\t"+e.id.slice(1).join("\t")};return this.init().then(function(t){var o=t.os("log","write");return i(o.index("id").get(e.id)).then(function(t){return!t&&i(o.add(n)).then(function(t){return e.added=t,e})})})},changeMeta:function(t,e){return this.init().then(function(n){var o=n.os("log","write");return i(o.index("id").get(t)).then(function(t){if(t){for(var n in e)t.meta[n]=e[n];return e.reasons&&(t.reasons=e.reasons),i(o.put(t)).then(function(){return!0})}return!1})})},removeReason:function(t,e,i){return this.init().then(function(o){var r=o.os("log","write"),s=r.index("reasons").openCursor(t);return new Promise(function(o,c){n(s,c),s.onsuccess=function(s){if(!s.target.result)return void o();var A=s.target.result.value,a=e;if(void 0!==a.minAdded&&A.added<a.minAdded)return void s.target.result.continue();if(void 0!==a.maxAdded&&A.added>a.maxAdded)return void s.target.result.continue();var d;1===A.reasons.length?(A.meta.reasons=[],A.meta.added=A.added,i(A.action,A.meta),d=r.delete(A.added)):(A.reasons.splice(A.reasons.indexOf(t),1),A.meta.reasons=A.reasons,d=r.put(A)),n(d,c),d.onsuccess=function(){s.target.result.continue()}}})})},getLastAdded:function(){return this.init().then(function(t){return i(t.os("log").openCursor(null,"prev"))}).then(function(t){return t?t.value.added:0})},getLastSynced:function(){return this.init().then(function(t){return i(t.os("extra").get("lastSynced"))}).then(function(t){return{sent:t.sent,received:t.received}})},setLastSynced:function(t){return this.init().then(function(e){var n=e.os("extra","write");return i(n.get("lastSynced")).then(function(e){return void 0!==t.sent&&(e.sent=t.sent),void 0!==t.received&&(e.received=t.received),i(n.put(e))})})},os:function(t,e){var n=e?"readwrite":"readonly";return this.db.transaction(t,n).objectStore(t)},clean:function(){return this.init().then(function(t){return t.db.close(),i(e.indexedDB.deleteDatabase(t.name))})}},t.exports=r}).call(e,n(7))},function(t,e){function n(t,e){if(t&&!e)return!1;if(!t&&e)return!0;if(t.time>e.time)return!1;if(t.time<e.time)return!0;var n=t.id.slice(1).join("\t"),i=e.id.slice(1).join("\t");return!(n>i)&&n<i}t.exports=n},function(t,e,n){function i(t){this.connected=!1,this.emitter=new o,this.url=t}var o=n(0);i.prototype={connect:function(){if(!window.WebSocket)throw new Error("Browser has no WebSocket support");this.emitter.emit("connecting"),this.ws=new window.WebSocket(this.url);var t=this;return this.ws.onclose=function(){t.connected=!1,t.emitter.emit("disconnect")},this.ws.onmessage=function(e){var n;try{n=JSON.parse(e.data)}catch(n){return void t.error(e.data)}t.emitter.emit("message",n)},new Promise(function(e){t.ws.onopen=function(){t.connected=!0,t.emitter.emit("connect"),e()}})},disconnect:function(){this.ws&&(this.ws.close(),this.ws.onclose(),this.ws=void 0)},on:function(t,e){return this.emitter.on(t,e)},send:function(t){if(!this.ws)throw new Error("Start a connection before send a message");this.ws.send(JSON.stringify(t))},error:function(t){var e=new Error("Wrong message format");e.received=t,this.emitter.emit("error",e)}},t.exports=i},function(t,e,n){function i(t,e,n,i){if(!t.options.auth)return t.authenticated=!0,void i();t.authenticating=!0,t.options.auth(n,e).then(function(e){if(e){t.authenticated=!0,t.authenticating=!1,i();for(var n=0;n<t.unauthenticated.length;n++)t.onMessage(t.unauthenticated[n]);t.unauthenticated=[]}else t.sendError(new r(t,"wrong-credentials")),t.destroy()})}function o(t){try{t.emitter.emit("connect")}catch(e){if("SyncError"===e.name)return t.sendError(e),!1;throw e}return!0}var r=n(6);t.exports={sendConnect:function(){var t=["connect",this.localProtocol,this.localNodeId,this.lastReceived],e={};this.options.credentials&&(e.credentials=this.options.credentials),this.options.subprotocol&&(e.subprotocol=this.options.subprotocol),Object.keys(e).length>0&&t.push(e),this.options.fixTime&&(this.connectSended=this.now()),this.startTimeout(),this.send(t)},sendConnected:function(t,e){var n=["connected",this.localProtocol,this.localNodeId,[t,e]],i={};this.options.credentials&&(i.credentials=this.options.credentials),this.options.subprotocol&&(i.subprotocol=this.options.subprotocol),Object.keys(i).length>0&&n.push(i),this.send(n)},connectMessage:function(t,e,n,s){var c=this.now();s||(s={}),this.remoteProtocol=t,this.remoteNodeId=e;var A=this.localProtocol[0];if(A!==t[0])return this.sendError(new r(this,"wrong-protocol",{supported:[A],used:t})),void this.destroy();if(this.remoteSubprotocol=s.subprotocol||"0.0.0",!o(this))return void this.destroy();var a=this;i(this,e,s.credentials,function(){a.sendConnected(c,a.now()),a.syncSince(n)})},connectedMessage:function(t,e,n,r){if(r||(r={}),this.endTimeout(),this.remoteProtocol=t,this.remoteNodeId=e,this.options.fixTime){var s=this.now(),c=n[1]-n[0],A=s-this.connectSended-c;this.timeFix=Math.floor(this.connectSended-n[0]+A/2)}if(this.remoteSubprotocol=r.subprotocol||"0.0.0",!o(this))return void this.destroy();var a=this;i(this,e,r.credentials,function(){a.syncSince(a.lastSent)})}}},function(t,e){t.exports={sendDebug:function(t,e){this.send(["debug",t,e])},debugMessage:function(t,e){this.emitter.emit("debug",t,e)}}},function(t,e){t.exports={sendError:function(t){var e=["error",t.type];void 0!==t.options&&e.push(t.options),this.send(e),this.emitter.emit("clientError",t)},errorMessage:function(t,e){this.syncError(t,e,!0)}}},function(t,e){t.exports={sendPing:function(){this.startTimeout(),this.send(["ping",this.lastAddedCache]),this.pingTimeout&&clearTimeout(this.pingTimeout)},pingMessage:function(t){this.setLastReceived(t),this.send(["pong",this.lastAddedCache])},pongMessage:function(t){this.setLastReceived(t),this.endTimeout()}}},function(t,e){t.exports={sendSync:function(){this.startTimeout();for(var t=0,e=[],n=0;n<arguments.length-1;n+=2){var i=arguments[n+1],o=i.time;this.timeFix&&(o-=this.timeFix),t<i.added&&(t=i.added),e.push(arguments[n],{id:i.id,time:o})}this.syncing+=1,this.setState("sending"),this.send(["sync",t].concat(e))},sendSynced:function(t){this.send(["synced",t])},syncMessage:function(t){for(var e=this,n=[],i=1;i<arguments.length-1;i+=2){var o=arguments[i],r=arguments[i+1],s=Promise.resolve([o,r]);this.options.inFilter&&(s=s.then(function(t){return e.options.inFilter(t[0],t[1]).then(function(e){return!!e&&t})})),s.then(function(t){return!!t&&(e.timeFix&&(t[1].time=t[1].time+e.timeFix),e.options.inMap?e.options.inMap(t[0],t[1]):t)}).then(function(t){return!!t&&(e.received[t[1].id.join("\t")]=!0,e.log.add(t[0],t[1]))}),n.push(s)}Promise.all(n).then(function(){e.setLastReceived(t),e.sendSynced(t)})},syncedMessage:function(t){this.setLastSent(t),this.syncing>0&&(this.syncing-=1),0===this.syncing&&(this.endTimeout(),this.setState("synchronized"))}}},function(t,e,n){function i(t,e){this.connection=t,this.options=o(e,r),this.reconnecting=t.connected,this.connecting=!1,this.attempts=0,this.unbind=[];var n=this;if(this.unbind.push(this.connection.on("message",function(t){"error"===t[0]&&s.indexOf(t[1])!==-1&&(n.reconnecting=!1)})),this.unbind.push(this.connection.on("connecting",function(){n.connecting=!0})),this.unbind.push(this.connection.on("connect",function(){n.attempts=0,n.connecting=!1})),this.unbind.push(this.connection.on("disconnect",function(){n.connecting=!1,n.reconnecting&&n.reconnect()})),this.unbind.push(function(){clearTimeout(n.timer)}),"undefined"!=typeof document&&void 0!==document.hidden){var i=this.visibilityChanged.bind(this);document.addEventListener("visibilitychange",i,!1),this.unbind.push(function(){document.removeEventListener("visibilitychange",i,!1)})}}var o=n(5),r={minDelay:1e3,maxDelay:5e3,attempts:1/0},s=["wrong-protocol","wrong-subprotocol","wrong-credentials"];i.prototype={connect:function(){return this.attempts+=1,this.reconnecting=!0,this.connection.connect()},disconnect:function(t){return"timeout"!==t&&(this.reconnecting=!1),this.connection.disconnect(t)},destroy:function(){for(var t=0;t<this.unbind.length;t++)this.unbind[t]();this.disconnect("destroy")},reconnect:function(){if(this.attempts>this.options.attempts-1)return this.reconnecting=!1,void(this.attempts=0);var t=this.nextDelay(),e=this;this.timer=setTimeout(function(){!e.reconnecting||e.connecting||e.connected||e.connect()},t)},send:function(){return this.connection.send.apply(this.connection,arguments)},on:function(){return this.connection.on.apply(this.connection,arguments)},nextDelay:function(){var t=this.options.minDelay*Math.pow(2,this.attempts),e=Math.random(),n=Math.floor(.5*e*t);return 1===Math.floor(10*e)&&(n=-n),Math.min(t+n,this.options.maxDelay)||0},visibilityChanged:function(){!this.reconnecting||this.connected||this.connecting||document.hidden||this.connect()}},Object.defineProperty(i.prototype,"connected",{get:function(){return this.connection.connected}}),t.exports=i},function(t,e,n){"use strict";function i(){h=!1}function o(t){if(!t)return void(d!==l&&(d=l,i()));if(t!==d){if(t.length!==l.length)throw new Error("Custom alphabet for shortid must be "+l.length+" unique characters. You submitted "+t.length+" characters: "+t);var e=t.split("").filter(function(t,e,n){return e!==n.lastIndexOf(t)});if(e.length)throw new Error("Custom alphabet for shortid must be "+l.length+" unique characters. These characters were not unique: "+e.join(", "));d=t,i()}}function r(t){return o(t),d}function s(t){g.seed(t),u!==t&&(i(),u=t)}function c(){d||o(l);for(var t,e=d.split(""),n=[],i=g.nextValue();e.length>0;)i=g.nextValue(),t=Math.floor(i*e.length),n.push(e.splice(t,1)[0]);return n.join("")}function A(){return h?h:h=c()}function a(t){return A()[t]}var d,u,h,g=n(31),l="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_-";t.exports={characters:r,seed:s,lookup:a,shuffled:A}},function(t,e,n){"use strict";function i(t){var e="",n=Math.floor(.001*(Date.now()-A));return n===r?o++:(o=0,r=n),e+=s(c.lookup,a),e+=s(c.lookup,t),o>0&&(e+=s(c.lookup,o)),e+=s(c.lookup,n)}var o,r,s=n(29),c=n(27),A=1459707606518,a=6;t.exports=i},function(t,e,n){"use strict";function i(t,e){for(var n,i=0,r="";!n;)r+=t(e>>4*i&15|o()),n=e<Math.pow(16,i+1),i++;return r}var o=n(30);t.exports=i},function(t,e,n){"use strict";function i(){if(!o||!o.getRandomValues)return 48&Math.floor(256*Math.random());var t=new Uint8Array(1);return o.getRandomValues(t),48&t[0]}var o="object"==typeof window&&(window.crypto||window.msCrypto);t.exports=i},function(t,e,n){"use strict";function i(){return(r=(9301*r+49297)%233280)/233280}function o(t){r=t}var r=1;t.exports={nextValue:i,seed:o}},function(t,e,n){var i=n(2),o=n(4),r=n(13),s=n(3),c=n(12),A=n(1),a=n(8),d=n(9),u=n(10),h=n(11),g=n(15),l=n(16),f=n(14),m=new r;new s("server",new A({store:new i,nodeId:"server"}),m.right);var p=new c({subprotocol:"1.0.0",userId:10,url:"wss://example.com/"});p.sync=new o(p.sync.localNodeId,p.log,m.left),a(p),d(p),u(p,{normal:g,offline:l,error:f}),h(p),p.sync.connection.connect(),document.all.connection.onchange=function(t){t.target.checked?p.sync.connection.connect():p.sync.connection.disconnect()},document.all.clientError.onclick=function(){setTimeout(function(){p.sync.syncError("wrong-format")},3e3)},document.all.serverError.onclick=function(){setTimeout(function(){m.right.send(["error","wrong-format"])},3e3)},document.all.add.onclick=function(){p.log.add({type:"TEST"},{reasons:["test"]})},document.all.clean.onclick=function(){p.log.removeReason("test")}}]);</script></body>
</html>
